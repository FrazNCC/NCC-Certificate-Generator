<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate Generator - Professional</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .nav-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            background: none;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #495057;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .nav-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
            margin-bottom: -2px;
        }

        .tab-content {
            padding: 40px;
        }

        .hidden {
            display: none !important;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #previewSection {
            margin-top: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: center;
        }

        #certificateCanvas {
            max-width: 100%;
            height: auto;
            border: 3px solid #dee2e6;
            border-radius: 8px;
            margin: 20px 0;
            background: white;
        }

        .file-upload {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            background: #e9ecef;
            border-color: #764ba2;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .csv-preview {
            margin-top: 30px;
            overflow-x: auto;
        }

        .csv-preview table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .csv-preview th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .csv-preview td {
            padding: 10px 12px;
            border-bottom: 1px solid #dee2e6;
        }

        .csv-preview tr:hover {
            background: #f8f9fa;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .toast.success {
            background: #28a745;
        }

        .toast.error {
            background: #dc3545;
        }

        .progress-container {
            margin-top: 20px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .status-message.show {
            display: block;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .tab-content {
                padding: 20px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ“ Certificate Generator</h1>
            <p>Professional Certificate Generation - Single or Bulk Mode</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="single">Single Certificate</button>
            <button class="nav-tab" data-tab="bulk">Bulk Certificates</button>
        </div>

        <!-- Single Certificate Tab -->
        <div id="singleTab" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #333;">Generate Single Certificate</h2>

            <form id="singleForm">
                <div class="form-group">
                    <label for="studentName">Student Name</label>
                    <input type="text" id="studentName" placeholder="Enter student name" required>
                </div>

                <div class="form-group">
                    <label for="courseName">Course Name</label>
                    <input type="text" id="courseName" placeholder="Enter course name" required>
                </div>

                <div class="form-group">
                    <label for="lecturerName">Lecturer Name</label>
                    <input type="text" id="lecturerName" placeholder="Enter lecturer name" required>
                </div>

                <div class="form-group">
                    <label for="issueDate">Issue Date</label>
                    <input type="date" id="issueDate" required>
                </div>

                <div class="form-group">
                    <label for="certificateType">Certificate Type</label>
                    <select id="certificateType" required>
                        <option value="Completion">Certificate of Completion</option>
                        <option value="Achievement">Certificate of Achievement</option>
                        <option value="Excellence">Certificate of Excellence</option>
                    </select>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-primary">Preview Certificate</button>
                </div>
            </form>

            <div id="previewSection" class="hidden">
                <h3>Certificate Preview</h3>
                <canvas id="certificateCanvas"></canvas>
                <div class="button-group">
                    <button id="generatePdfBtn" class="btn btn-success">Generate PDF</button>
                </div>
            </div>
        </div>

        <!-- Bulk Certificate Tab -->
        <div id="bulkTab" class="tab-content hidden">
            <h2 style="margin-bottom: 20px; color: #333;">Generate Bulk Certificates</h2>

            <div class="info-box">
                ðŸ“‹ Upload a CSV file with student data. Format: Student Name, Course Name, Lecturer Name, Issue Date, Certificate Type
            </div>

            <div style="margin-bottom: 20px;">
                <button id="downloadSampleBtn" class="btn btn-secondary">ðŸ“¥ Download Sample CSV</button>
            </div>

            <!-- Simple File Input -->
            <div style="margin-bottom: 20px;">
                <input type="file" id="csvFile" accept=".csv" style="display: block; padding: 10px; border: 2px solid #667eea; border-radius: 8px; width: 100%;">
            </div>

            <button id="uploadCsvBtn" class="btn btn-primary">ðŸ“¤ Upload & Preview CSV</button>

            <div id="csvStatus" class="status-message"></div>

            <!-- Preview Table -->
            <div id="csvPreviewContainer" class="csv-preview hidden">
                <h3 style="margin-bottom: 20px; color: #333;">Preview (<span id="rowCount">0</span> rows)</h3>
                <table id="csvTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Student Name</th>
                            <th>Course Name</th>
                            <th>Lecturer Name</th>
                            <th>Issue Date</th>
                            <th>Type</th>
                        </tr>
                    </thead>
                    <tbody id="csvTableBody"></tbody>
                </table>

                <div class="button-group" style="margin-top: 20px;">
                    <button id="generateAllBtn" class="btn btn-success">ðŸŽ¯ Generate All PDFs (ZIP)</button>
                </div>
            </div>

            <!-- Progress -->
            <div id="progressContainer" class="progress-container">
                <p id="progressText">Generating certificates...</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
            </div>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
// ================================================================
// SIMPLE WORKING BULK UPLOAD SYSTEM
// ================================================================

let logoImage = null;
let csvDataArray = [];

// Load logo
function loadLogo() {
    logoImage = new Image();
    logoImage.src = 'logo-1.png';
    logoImage.crossOrigin = "Anonymous";
}

// Initialize
window.addEventListener('DOMContentLoaded', function() {
    loadLogo();
    setDefaultDate();
    setupEventListeners();
});

function setDefaultDate() {
    document.getElementById('issueDate').value = new Date().toISOString().split('T')[0];
}

function setupEventListeners() {
    // Tabs
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', (e) => {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            e.target.classList.add('active');

            document.getElementById('singleTab').classList.add('hidden');
            document.getElementById('bulkTab').classList.add('hidden');

            if (e.target.dataset.tab === 'single') {
                document.getElementById('singleTab').classList.remove('hidden');
            } else {
                document.getElementById('bulkTab').classList.remove('hidden');
            }
        });
    });

    // Single mode
    document.getElementById('singleForm').addEventListener('submit', handlePreview);
    document.getElementById('generatePdfBtn').addEventListener('click', generateSinglePdf);

    // Bulk mode
    document.getElementById('downloadSampleBtn').addEventListener('click', downloadSampleCsv);
    document.getElementById('uploadCsvBtn').addEventListener('click', uploadCsv);
    document.getElementById('generateAllBtn').addEventListener('click', generateAllPdfs);
}

// ========== SINGLE MODE ==========
function handlePreview(e) {
    e.preventDefault();

    const data = {
        studentName: document.getElementById('studentName').value,
        courseName: document.getElementById('courseName').value,
        lecturerName: document.getElementById('lecturerName').value,
        issueDate: document.getElementById('issueDate').value,
        certificateType: document.getElementById('certificateType').value
    };

    drawCertificate(data);
    document.getElementById('previewSection').classList.remove('hidden');
    document.getElementById('generatePdfBtn').disabled = false;
}

function generateSinglePdf() {
    const canvas = document.getElementById('certificateCanvas');
    const imgData = canvas.toDataURL('image/png');

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({
        orientation: 'landscape',
        unit: 'mm',
        format: 'a4'
    });

    pdf.addImage(imgData, 'PNG', 0, 0, 297, 210);

    const studentName = document.getElementById('studentName').value;
    const courseName = document.getElementById('courseName').value;
    const filename = (courseName + '_' + studentName).replace(/[^a-z0-9]/gi, '_').toLowerCase() + '.pdf';

    pdf.save(filename);
    showToast('PDF generated: ' + filename, 'success');
}

// ========== BULK MODE ==========
function downloadSampleCsv() {
    const csv = 'Student Name,Course Name,Lecturer Name,Issue Date,Certificate Type\nJohn Smith,Advanced Python,Dr. Jane Doe,2025-11-16,Completion\nSarah Lee,Web Development,Prof. Bob Smith,2025-11-16,Achievement\nMike Johnson,Data Science,Dr. Anna White,2025-11-16,Excellence';

    const blob = new Blob([csv], { type: 'text/csv' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'sample_certificates.csv';
    link.click();

    showToast('Sample CSV downloaded', 'success');
}

function uploadCsv() {
    const fileInput = document.getElementById('csvFile');
    const file = fileInput.files[0];

    if (!file) {
        showToast('Please select a CSV file', 'error');
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const csv = e.target.result;
            const lines = csv.trim().split('\n');

            if (lines.length < 2) {
                showToast('CSV file must have header and at least one row', 'error');
                return;
            }

            const headers = lines[0].split(',').map(h => h.trim());
            const requiredHeaders = ['Student Name', 'Course Name', 'Lecturer Name', 'Issue Date', 'Certificate Type'];

            const missingHeaders = requiredHeaders.filter(h => !headers.includes(h));
            if (missingHeaders.length > 0) {
                showToast('Missing columns: ' + missingHeaders.join(', '), 'error');
                return;
            }

            csvDataArray = [];
            let validCount = 0;

            for (let i = 1; i < lines.length; i++) {
                const row = lines[i].split(',').map(cell => cell.trim());

                if (row.length < headers.length) continue;
                if (!row[0] || !row[1] || !row[2] || !row[3] || !row[4]) continue;

                csvDataArray.push({
                    studentName: row[0],
                    courseName: row[1],
                    lecturerName: row[2],
                    issueDate: row[3],
                    certificateType: row[4]
                });
                validCount++;
            }

            if (csvDataArray.length === 0) {
                showToast('No valid rows found in CSV', 'error');
                return;
            }

            displayCsvPreview();
            showToast(validCount + ' valid certificates found', 'success');

        } catch(error) {
            showToast('Error reading CSV: ' + error.message, 'error');
            console.error(error);
        }
    };

    reader.readAsText(file);
}

function displayCsvPreview() {
    const tbody = document.getElementById('csvTableBody');
    tbody.innerHTML = '';

    csvDataArray.forEach((row, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = '<td>' + (index + 1) + '</td>' +
            '<td>' + row.studentName + '</td>' +
            '<td>' + row.courseName + '</td>' +
            '<td>' + row.lecturerName + '</td>' +
            '<td>' + row.issueDate + '</td>' +
            '<td>' + row.certificateType + '</td>';
        tbody.appendChild(tr);
    });

    document.getElementById('rowCount').textContent = csvDataArray.length;
    document.getElementById('csvPreviewContainer').classList.remove('hidden');
}

async function generateAllPdfs() {
    if (csvDataArray.length === 0) {
        showToast('No CSV data loaded', 'error');
        return;
    }

    const btn = document.getElementById('generateAllBtn');
    btn.disabled = true;
    btn.textContent = 'Generating...';

    document.getElementById('progressContainer').style.display = 'block';

    try {
        const zip = new JSZip();
        const { jsPDF } = window.jspdf;
        const total = csvDataArray.length;

        for (let i = 0; i < total; i++) {
            const cert = csvDataArray[i];

            // Create canvas for this certificate
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = 3366;  // 1122 * 3
            tempCanvas.height = 2382; // 794 * 3
            const ctx = tempCanvas.getContext('2d');
            ctx.scale(3, 3);

            // Draw certificate
            drawCertificateOnCanvas(ctx, cert);

            // Convert to PDF
            const imgData = tempCanvas.toDataURL('image/png');
            const pdf = new jsPDF({
                orientation: 'landscape',
                unit: 'mm',
                format: 'a4'
            });
            pdf.addImage(imgData, 'PNG', 0, 0, 297, 210);

            // Add to ZIP
            const filename = (cert.courseName + '_' + cert.studentName).replace(/[^a-z0-9]/gi, '_').toLowerCase() + '.pdf';
            zip.file(filename, pdf.output('blob'));

            // Update progress
            const progress = Math.round(((i + 1) / total) * 100);
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressFill').textContent = progress + '%';
            document.getElementById('progressText').textContent = 'Generated ' + (i + 1) + ' of ' + total;

            // Small delay to prevent freezing
            if (i % 10 === 0) {
                await new Promise(resolve => setTimeout(resolve, 50));
            }
        }

        // Download ZIP
        const zipBlob = await zip.generateAsync({ type: 'blob' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(zipBlob);
        link.download = 'certificates.zip';
        link.click();

        showToast('Generated ' + total + ' certificates!', 'success');

    } catch(error) {
        showToast('Error: ' + error.message, 'error');
        console.error(error);
    } finally {
        btn.disabled = false;
        btn.textContent = 'ðŸŽ¯ Generate All PDFs (ZIP)';
        document.getElementById('progressContainer').style.display = 'none';
    }
}

// ========== DRAWING FUNCTIONS ==========
function drawCertificate(data) {
    const canvas = document.getElementById('certificateCanvas');
    drawCertificateImpl(canvas, data, 3);
}

function drawCertificateOnCanvas(ctx, data) {
    drawCertificateCore(ctx, data);
}

function drawCertificateImpl(canvas, data, scale) {
    canvas.width = 1122 * scale;
    canvas.height = 794 * scale;
    const ctx = canvas.getContext('2d');
    ctx.scale(scale, scale);
    drawCertificateCore(ctx, data);
}

function drawCertificateCore(ctx, data) {
    // Background
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, 1122, 794);

    // Outer gold border
    ctx.strokeStyle = '#d4af37';
    ctx.lineWidth = 12;
    ctx.strokeRect(30, 30, 1062, 734);

    // Inner border
    ctx.strokeStyle = '#b8860b';
    ctx.lineWidth = 2;
    ctx.strokeRect(45, 45, 1032, 704);

    // Draw logo
    if (logoImage && logoImage.complete) {
        try {
            const logoMaxSize = 300;
            const ratio = logoImage.width / logoImage.height;
            let w = logoMaxSize, h = logoMaxSize;

            if (ratio > 1) h = w / ratio;
            else w = h * ratio;

            ctx.drawImage(logoImage, 561 - w/2, 60, w, h);
        } catch(e) {}
    }

// Title
ctx.fillStyle = '#bda054';
ctx.font = '900 48px Merriweather, serif';   // increased size
ctx.textAlign = 'center';

const titleText = ('Certificate of ' + data.certificateType).toUpperCase();  
ctx.fillText(titleText, 561, 250);           // uppercase text

    // Line
    ctx.strokeStyle = '#d4af37';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(361, 270);
    ctx.lineTo(761, 270);
    ctx.stroke();

    // Text
    ctx.fillStyle = '#23335c';
    ctx.font = '400 25px Merriweather, serif';
    ctx.fillText('This certificate is proudly presented to', 561, 330);

    // Student name
    ctx.font = 'bold 44px Georgia, serif';
    ctx.fillText(data.studentName, 561, 380);

    // Underline
    const nameWidth = ctx.measureText(data.studentName).width;
    ctx.strokeStyle = '#d4af37';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(561 - nameWidth/2 - 15, 400);
    ctx.lineTo(561 + nameWidth/2 + 15, 400);
    ctx.stroke();

    // Course text
    ctx.fillStyle = '#23335c';
    ctx.font = '400 25px Merriweather, serif';
    ctx.fillText('for successfully demonstrating proficiency and completing all the requirements of the course', 561, 470);

    // Course name
    ctx.font = 'bold 32px Georgia, serif';
    ctx.fillText(data.courseName, 561, 520);

    // Course underline
    const courseWidth = ctx.measureText(data.courseName).width;
    ctx.strokeStyle = '#d4af37';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(561 - courseWidth/2 - 15, 540);
    ctx.lineTo(561 + courseWidth/2 + 15, 540);
    ctx.stroke();

    // Lecturer label (bottom-right block)
    ctx.fillStyle = '#1a1a2e';
    ctx.textAlign = 'right';

    // Lecturer text
    ctx.font = 'italic 25px Georgia, serif';
    ctx.fillText('under the instruction of', 1050, 720);  // adjust X to right edge

    // Lecturer name
    ctx.font = 'bold 35px Georgia, serif';
    ctx.fillText(data.lecturerName, 1050, 760);  // same right edge alignment

    // Date (bottom-left)
    ctx.textAlign = 'left';
    ctx.font = 'italic 30px Georgia, serif';
    ctx.fillStyle = '#1a1a2e';
    ctx.fillText('Issued: ' + formattedDate, 70, 760);   // adjust X to left edge

}

// ========== UTILITY ==========
function showToast(message, type) {
    const toast = document.createElement('div');
    toast.className = 'toast ' + type;
    toast.textContent = message;
    document.body.appendChild(toast);

    setTimeout(() => toast.remove(), 3000);
}
    </script>
</body>
</html>
